# ANN Model for Hybrid Nanofluid Boundary Layer Flow

## Overview

This project implements a **traditional Artificial Neural Network (ANN)** trained with the **Levenberg-Marquardt algorithm** to predict the flow and thermal characteristics of hybrid nanofluids over a stretching sheet. The model is trained on ground-truth numerical data generated by solving the coupled nonlinear ODEs from the manuscript.

**Key Features:**
- ✅ Pure data-driven ANN (not PINN)
- ✅ 9 hidden layers × 30 neurons with tanh activation
- ✅ Levenberg-Marquardt optimization
- ✅ Numerical ODE solver using scipy.integrate.solve_bvp
- ✅ Comprehensive dataset generation across parameter space
- ✅ Manuscript-style visualization

---

## Project Structure

```
ann-hybrid-flow/
├── ANN_task_eta_mapping/          # [NEW] Dedicated task: Eta -> f, theta
│   ├── data/                     # Task-specific data
│   ├── models/                   # Task-specific models
│   ├── plots/                    # Task-specific plots
│   ├── generate_task_data.py     # Data generation
│   ├── train_task_model.py       # Model training
│   ├── test_task_model.py        # Testing & plotting
│   └── manual_check.py           # Manual verification tool
├── data/                          # Full project datasets
├── models/                        # Shared model implementations
│   ├── ann.py                    # ANN architecture
│   ├── lm_optimizer.py           # Levenberg-Marquardt optimizer
│   └── checkpoints/              # Saved models and scalers
├── solver/                        # Numerical ODE solver
│   └── ode_solver.py             # BVP solver for ground truth
├── plots/                         # Generated figures
├── generate_data.py              # Full dataset generation script
├── train_ann.py                  # Full training pipeline
├── validate_model.py             # Full validation script
├── requirements.txt              # Python dependencies
└── README.md                     # This file
```

---

## Physical Model

### Governing Equations

The model solves the following coupled ODEs from the manuscript:

**Momentum Equation (Eq. 8):**
```
(ν_hnf/ν_f) f''' + f·f'' + (2n)/(n+1)·(1 - f'^2) - 2/(n+1)·(σ_hnf/σ_f)·(ρ_f/ρ_hnf)·M·(f' - 1) = 0
```

**Energy Equation (Eq. 9):**
```
(κ_hnf/κ_f + Nr/(1 + (Tr-1)θ)^3)·θ'' + Pr·As·(f·θ' - 2(2n-1)/(n+1)·f'·θ) 
  + 3·Nr·(Tr-1)/(1 + (Tr-1)θ)^2·(θ')^2 = 0
```

**Boundary Conditions (Eq. 10):**
```
At η = 0:
  f(0) = 0
  f'(0) = 1 + β·f''(0)
  θ'(0) = -Nh·(1 - θ(0))

At η → ∞:
  f'(∞) → 1
  θ(∞) → 0
```

### Parameters

| Symbol | Description | Range |
|--------|-------------|-------|
| M | Magnetic parameter | [0.5, 1.0, 2.0] |
| Nr | Radiation parameter | [0.2, 0.5, 1.0] |
| Nh | Convective heat transfer parameter | [0.2, 0.5, 1.0] |
| λ | Stretching parameter | [0.5, 1.0, 2.0] |
| β | Velocity slip parameter | 0.1 |
| Pr | Prandtl number | 6.2 (water-based) |
| n | Power-law index | 1.0 |
| Tr | Temperature ratio | 1.5 |
| As | Unsteadiness parameter | 1.0 |

### Engineering Quantities

- **Skin Friction Coefficient:** `Cf = f''(0)`
- **Nusselt Number:** `Nu = -θ'(0)`

---

## Installation

### Prerequisites
- Python 3.10 or higher
- pip package manager

### Setup

1. **Clone or navigate to the project directory:**
```bash
cd "e:/University/FYDP/ANN net"
```

2. **Install dependencies:**
```bash
pip install -r requirements.txt
```

Required packages:
- torch >= 2.0.0
- numpy >= 1.24.0
- scipy >= 1.10.0
- matplotlib >= 3.7.0
- pandas >= 2.0.0
- tqdm >= 4.65.0
- scikit-learn >= 1.3.0

---

## Usage

### 1. Specific Task: Eta Mapping (Recommended Start)
For the specific task of mapping `eta` to `f` and `theta` (Base Case), use the dedicated folder:

**Generate Data:**
```bash
python ANN_task_eta_mapping/generate_task_data.py
```

**Train Model:**
```bash
python ANN_task_eta_mapping/train_task_model.py
```

**Test & Plot:**
```bash
python ANN_task_eta_mapping/test_task_model.py
```

**Manual Check:**
```bash
python ANN_task_eta_mapping/manual_check.py
```

---

### 2. Full Project Workflow
For the complete parameter sweep and advanced training:

**Step 1: Generate Full Training Data**
```bash
python generate_data.py
```
*Generates ~32,400 samples across 81 parameter combinations.*

**Step 2: Train Full Model**
```bash
python train_ann.py
```
*Trains the model on the full dataset using L-BFGS or LM optimization.*

**Step 3: Validate Model**
```bash
python validate_model.py
```
*Performs comprehensive validation against numerical ground truth.*

---

## Model Architecture

### ANN Structure

```
Input Layer:     1 neuron  (η)
                 ↓
Hidden Layer 1:  30 neurons (tanh)
Hidden Layer 2:  30 neurons (tanh)
...
Hidden Layer 9:  30 neurons (tanh)
                 ↓
Output Layer:    2 neurons  (f, θ)
```

**Total Parameters:** ~8,732

**Initialization:** Xavier uniform

**Activation:** Hyperbolic tangent (tanh)

---

## Levenberg-Marquardt Optimization

The LM algorithm combines:
- **Gradient Descent** (for far from optimum)
- **Gauss-Newton** (for near optimum)

**Update Rule:**
```
(J^T·J + λ·I)·Δp = -J^T·r

where:
  J = Jacobian matrix
  r = residuals (predictions - targets)
  λ = damping parameter (adaptive)
  Δp = parameter update
```

**Adaptive Damping:**
- Successful step → λ = λ × 0.1 (move toward Gauss-Newton)
- Failed step → λ = λ × 10 (move toward gradient descent)

**Implementation:**
- Primary: `scipy.optimize.least_squares` (stable, efficient)
- Alternative: Custom PyTorch implementation (for research)

---

## Troubleshooting

### Common Issues

**1. ODE Solver Fails:**
```
Solution: Adjust initial guess or increase max_nodes
File: solver/ode_solver.py, line 120
```

**2. Training Loss Not Decreasing:**
```
Solution: 
- Check data normalization
- Reduce learning rate (adjust λ_init in LM optimizer)
- Increase max_nfev in scipy optimizer
```

**3. Memory Error:**
```
Solution: Reduce batch_size in train_ann.py
Current: 2000 → Try: 1000 or 500
```

---

## File Descriptions

### Task Specific (`ANN_task_eta_mapping/`)
- **`generate_task_data.py`**: Generates single-case data for eta mapping.
- **`train_task_model.py`**: Trains the specific model for eta -> f, theta.
- **`test_task_model.py`**: Generates plots and metrics for the task.
- **`manual_check.py`**: Interactive tool for verifying specific values.

### Core Scripts
- **`generate_data.py`**: Generates full numerical solutions.
- **`train_ann.py`**: Full training pipeline.
- **`validate_model.py`**: Comprehensive validation.

### Model Files
- **`models/ann.py`**: ANN architecture definition.
- **`models/lm_optimizer.py`**: Custom LM optimizer.
- **`solver/ode_solver.py`**: Numerical ODE solver.

---

## Citation

If you use this code, please cite the manuscript:

```
[Manuscript citation to be added]
```

---

## License

This project is for academic and research purposes.

---

## Acknowledgments

- Numerical solver: scipy.integrate.solve_bvp
- Deep learning framework: PyTorch
- Optimization: Levenberg-Marquardt algorithm

---

**Last Updated:** 2025-11-21
**Version:** 1.1.0
**Status:** ✅ Complete and tested
